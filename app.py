from flask import Flask, request, render_template, jsonify
import re

app = Flask(__name__)

# 簡單的關鍵字偵測機率邏輯
scam_keywords = [
    "中獎", "緊急", "立刻", "拜託", "匯款", "ATM", "免費", 
    "投資", "高薪", "限時", "趕緊", "解除設定", "帳戶異常", 
    "保證金", "代辦", "現金卡", "LINE 群組",  "不會害你", "不騙你", "只有你", "忍心", "求求", "沒有人", "走投無路", "拜託", "救命", "救救我",
    "無路可走", "無親無故", "發誓", "撐不下去", "幫忙", "舉目無親", "否則", "ATM", "不准", "不得",
    "切勿", "勿", "必須", "依照", "保持", "保密", "按照", "配合", "務必", "帳戶", "單線聯繫", "禁止",
    "請", "請勿", "轉帳", "不然", "收屍", "判刑", "沒命", "拘捕", "法辦", "後果自負", "查封", "強制執行",
    "通緝", "監管", "撕票", "凍結", "停機", "勒令", "工作人員", "公安局", "支付平臺", "刑事警察", 
    "地方法院", "安全中心", "行政執行署", "伯父", "快遞", "法官", "爸", "物流公司", "阿姨", "客服", 
    "客服中心", "客服專線", "海關", "偵查科", "專員", "猜猜我是誰", "稅務局", "媽", "經理", "管理員", 
    "調查局", "親愛的", "購物網客服", "寶貝", "警官", "警員", "警察", "警察局", "法院", "員警", 
    "通訊管理局", "銀行", "銀行客服", "檢察官", "分鐘內", "立即", "立刻", "刻不容緩", "秒殺", 
    "馬上", "趕快", "趕緊", "儘早", "儘快", "中獎", "保證金", "內部消息", "只需", "巨額", "名額", 
    "名額有限", "回報", "回饋", "收益", "免費", "利息", "利潤", "即可", "返利", "返還", "保障", 
    "保證", "後悔", "活動", "紅包", "限時", "限量", "恭喜", "高回報", "高收益", "現金", "最後機會", 
    "無風險", "僅需", "補助", "補貼", "福利", "獎金", "獎品", "獎勵", "錯過", "優惠", "翻倍", "豐厚", 
    "穩賺", "穩賺不賠", "贈送"
]
# ✅ 改這裡：根據命中數回傳機率
def predict_scam_probability(text):
    count = sum(1 for kw in scam_keywords if kw in text)
    
    if count >= 5:
        prob = 1.0
    elif count >= 3:
        prob = 0.5
    elif count >= 1:
        prob = 0.1
    else:
        prob = 0.0

    return prob, count

@app.route('/')
def home():
    return render_template('index.html')

@app.route('/predict', methods=['POST'])
def predict():
    input_text = request.form['text']
    prob, count = predict_scam_probability(input_text)
    return jsonify({
        'probability': f"{prob * 100:.2f}%",
        'keyword_count': count
    })

if __name__ == '__main__':
    app.run(debug=True)